# StreamVLN Training Parameters Guide

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ StreamVLN è®­ç»ƒè„šæœ¬ä¸­çš„æ‰€æœ‰å‚æ•°ã€‚

## ğŸ“š ç›®å½•

- [åŸºç¡€å‚æ•°](#åŸºç¡€å‚æ•°)
- [æ··åˆè®­ç»ƒå‚æ•°](#æ··åˆè®­ç»ƒå‚æ•°)
- [ä¸“å®¶å¹²é¢„å‚æ•°](#ä¸“å®¶å¹²é¢„å‚æ•°)
- [GRPOå‚æ•°](#grpoå‚æ•°)
- [WandBå‚æ•°](#wandbå‚æ•°)

---

## åŸºç¡€å‚æ•°

### `--model_path`
- **ç±»å‹**: string
- **å¿…éœ€**: æ˜¯
- **è¯´æ˜**: é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„
- **ç¤ºä¾‹**: `checkpoints/StreamVLN_Video_qwen_1_5_r2r_rxr_envdrop_scalevln_v1_3`

### `--habitat_config_path`
- **ç±»å‹**: string
- **å¿…éœ€**: æ˜¯
- **è¯´æ˜**: Habitatç¯å¢ƒé…ç½®æ–‡ä»¶è·¯å¾„
- **ç¤ºä¾‹**: `config/vln_r2r_rxr.yaml`

### `--output_path`
- **ç±»å‹**: string
- **å¿…éœ€**: æ˜¯
- **è¯´æ˜**: è®­ç»ƒè¾“å‡ºç›®å½•ï¼ˆä¿å­˜æ£€æŸ¥ç‚¹å’Œæ—¥å¿—ï¼‰
- **ç¤ºä¾‹**: `result/grpo_hybrid_trainingV10_multi_dataset`

### `--phase`
- **ç±»å‹**: string
- **é»˜è®¤**: `phase1_stop`
- **é€‰é¡¹**: `phase1_stop`, `phase2_progress`
- **è¯´æ˜**: è®­ç»ƒé˜¶æ®µ
  - `phase1_stop`: å­¦ä¹ ä½•æ—¶åœæ­¢
  - `phase2_progress`: å­¦ä¹ å¯¼èˆªè¿›åº¦

---

## æ··åˆè®­ç»ƒå‚æ•°

### `--use_hybrid_training`
- **ç±»å‹**: flag
- **é»˜è®¤**: False
- **è¯´æ˜**: å¯ç”¨GRPO+SFTæ··åˆè®­ç»ƒæ¨¡å¼
- **æ•ˆæœ**: Loss = GRPO_loss + dynamic_weight Ã— SFT_loss

### `--sft_loss_start_weight`
- **ç±»å‹**: float
- **é»˜è®¤**: 1.0
- **èŒƒå›´**: [0.0, 2.0]
- **è¯´æ˜**: SFTæŸå¤±çš„åˆå§‹æƒé‡
- **å»ºè®®**: 
  - 1.0-1.5: æ ‡å‡†è®¾ç½®ï¼Œå¹³è¡¡GRPOå’ŒSFT
  - 0.5-1.0: æ›´ä¾§é‡GRPO
  - 1.5-2.0: æ›´ä¾§é‡ç›‘ç£å­¦ä¹ 

### `--sft_loss_end_weight`
- **ç±»å‹**: float
- **é»˜è®¤**: 0.5
- **èŒƒå›´**: [0.0, 1.0]
- **è¯´æ˜**: SFTæŸå¤±çš„æœ€ç»ˆç¨³å®šæƒé‡
- **å»ºè®®**: 
  - 0.5-0.9: ä¿æŒè¾ƒå¼ºçš„ç›‘ç£ä¿¡å·
  - 0.1-0.5: è®©GRPOä¸»å¯¼åæœŸè®­ç»ƒ

### `--sft_loss_decay_updates`
- **ç±»å‹**: int
- **é»˜è®¤**: 200
- **è¯´æ˜**: ä»start_weightè¡°å‡åˆ°end_weightæ‰€éœ€çš„æ›´æ–°æ¬¡æ•°
- **å»ºè®®**: 
  - 100-200: å¿«é€Ÿè¡°å‡
  - 400-600: å¹³æ»‘è¡°å‡

### `--sft_loss_decay_type`
- **ç±»å‹**: string
- **é»˜è®¤**: `cosine`
- **é€‰é¡¹**: `linear`, `cosine`, `exponential`
- **è¯´æ˜**: æƒé‡è¡°å‡æ›²çº¿ç±»å‹
  - `linear`: çº¿æ€§è¡°å‡
  - `cosine`: ä½™å¼¦è¡°å‡ï¼ˆæ¨èï¼Œå¹³æ»‘è¿‡æ¸¡ï¼‰
  - `exponential`: æŒ‡æ•°è¡°å‡ï¼ˆå¿«é€Ÿä¸‹é™ï¼‰

### `--sft_use_policy_steps` / `--sft_oracle_only`
- **ç±»å‹**: flagï¼ˆäº’æ–¥ï¼‰
- **é»˜è®¤**: `sft_use_policy_steps`
- **è¯´æ˜**: SFTæ•°æ®æºæ§åˆ¶
  - `--sft_use_policy_steps`: ä½¿ç”¨ç­–ç•¥æ­¥éª¤ + ä¸“å®¶æ¼”ç¤º
  - `--sft_oracle_only`: ä»…ä½¿ç”¨ä¸“å®¶æ¼”ç¤ºï¼ˆçº¯æ¨¡ä»¿å­¦ä¹ ï¼‰

---

## ä¸“å®¶å¹²é¢„å‚æ•°

### `--enable_recovery`
- **ç±»å‹**: flag
- **é»˜è®¤**: True
- **è¯´æ˜**: å¯ç”¨ä¸“å®¶å¹²é¢„ç³»ç»Ÿ
- **å…³é—­**: ä½¿ç”¨ `--disable_recovery`

### åç¦»æ£€æµ‹å‚æ•°

#### `--offtrack_dist_thresh`
- **ç±»å‹**: float
- **é»˜è®¤**: 3.0
- **å•ä½**: ç±³
- **è¯´æ˜**: è·ç¦»å‚è€ƒè·¯å¾„å¤šè¿œç®—åç¦»
- **å»ºè®®**: 
  - 2.0-3.0: æ ‡å‡†è®¾ç½®
  - 3.0-5.0: å…è®¸æ›´å¤šæ¢ç´¢

#### `--offtrack_heading_thresh_deg`
- **ç±»å‹**: float
- **é»˜è®¤**: 120.0
- **å•ä½**: åº¦
- **è¯´æ˜**: æœå‘åç¦»å¤šå°‘åº¦ç®—åç¦»
- **å»ºè®®**: 
  - 90-120Â°: æ ‡å‡†è®¾ç½®
  - 120-180Â°: æ›´å®½æ¾

#### `--offtrack_patience`
- **ç±»å‹**: int
- **é»˜è®¤**: 8
- **è¯´æ˜**: è¿ç»­åç¦»å¤šå°‘æ­¥åè§¦å‘å¹²é¢„
- **å»ºè®®**: 
  - 5-8: å¹³è¡¡å®¹å¿åº¦
  - 10+: å…è®¸é•¿æ—¶é—´æ¢ç´¢

#### `--heading_guard_dist`
- **ç±»å‹**: float
- **é»˜è®¤**: 3.0
- **å•ä½**: ç±³
- **è¯´æ˜**: åªåœ¨è·ç¦»è·¯å¾„å¤§äºæ­¤å€¼æ—¶æ£€æŸ¥æœå‘
- **ä½œç”¨**: é¿å…åœ¨è·¯å¾„é™„è¿‘å› è½¬å¼¯è§¦å‘è¯¯æŠ¥

### æ¢å¤å‚æ•°

#### `--lookahead_k`
- **ç±»å‹**: int
- **é»˜è®¤**: 1
- **è¯´æ˜**: å‚è€ƒè·¯å¾„å‰ç»çš„èˆªç‚¹æ•°
- **å»ºè®®**: 
  - 1: æ ‡å‡†è®¾ç½®ï¼Œè·Ÿéšæœ€è¿‘èˆªç‚¹
  - 2-3: æ›´å¹³æ»‘çš„è½¨è¿¹

#### `--recovery_dist_thresh`
- **ç±»å‹**: float
- **é»˜è®¤**: 2.0
- **å•ä½**: ç±³
- **è¯´æ˜**: æ¢å¤åˆ°è·¯å¾„å¤šè¿‘å¯ä»¥é€€å‡º
- **å»ºè®®**: ä¿æŒ < offtrack_dist_thresh

#### `--recovery_heading_thresh_deg`
- **ç±»å‹**: float
- **é»˜è®¤**: 45.0
- **å•ä½**: åº¦
- **è¯´æ˜**: æœå‘å¯¹é½å¤šå°‘åº¦å¯ä»¥é€€å‡ºæ¢å¤

#### `--recovery_max_steps`
- **ç±»å‹**: int
- **é»˜è®¤**: 100
- **è¯´æ˜**: æ¢å¤æ¨¡å¼æœ€å¤§æ­¥æ•°ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰

### ç›®æ ‡åŒºåŸŸä¿æŠ¤

#### `--goal_radius`
- **ç±»å‹**: float
- **é»˜è®¤**: 3.0
- **å•ä½**: ç±³
- **è¯´æ˜**: ç›®æ ‡åŒºåŸŸåŠå¾„ï¼Œæ­¤èŒƒå›´å†…ç¦ç”¨å¹²é¢„

#### `--goal_grace_steps`
- **ç±»å‹**: int
- **é»˜è®¤**: 7
- **è¯´æ˜**: è¿›å…¥ç›®æ ‡åŒºåŸŸåçš„å®½é™æ­¥æ•°

#### `--goal_stop_patience`
- **ç±»å‹**: int
- **é»˜è®¤**: 5
- **è¯´æ˜**: ç›®æ ‡åŒºåŸŸå†…å¤šå°‘æ­¥åå¼ºåˆ¶STOP

---

## GRPOå‚æ•°

### `--num_updates`
- **ç±»å‹**: int
- **é»˜è®¤**: 500
- **è¯´æ˜**: æ€»è®­ç»ƒæ›´æ–°æ¬¡æ•°
- **å»ºè®®**: 
  - 300-500: æ ‡å‡†è®­ç»ƒ
  - 800-1000: å®Œæ•´è®­ç»ƒ

### `--num_episodes_per_update`
- **ç±»å‹**: int
- **é»˜è®¤**: 1
- **è¯´æ˜**: æ¯æ¬¡æ›´æ–°ä½¿ç”¨çš„episodeæ•°é‡
- **æ³¨æ„**: å®é™…æ‰¹é‡ = num_episodes_per_update Ã— group_size

### `--group_size`
- **ç±»å‹**: int
- **é»˜è®¤**: 2
- **è¯´æ˜**: æ¯ä¸ªæŒ‡ä»¤é‡‡æ ·çš„è½¨è¿¹æ•°
- **ä½œç”¨**: ç”¨äºGRPOçš„ä¼˜åŠ¿ä¼°è®¡

### `--learning_rate`
- **ç±»å‹**: float
- **é»˜è®¤**: 5e-7
- **è¯´æ˜**: å­¦ä¹ ç‡
- **å»ºè®®**: 
  - 1e-7: ä¿å®ˆ
  - 5e-7: æ ‡å‡†ï¼ˆæ¨èï¼‰
  - 1e-6: æ¿€è¿›

### `--ppo_epochs`
- **ç±»å‹**: int
- **é»˜è®¤**: 1
- **è¯´æ˜**: PPOä¼˜åŒ–è½®æ•°
- **æ³¨æ„**: å¢åŠ å¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆ

### `--mini_batch_size`
- **ç±»å‹**: int
- **é»˜è®¤**: 2
- **è¯´æ˜**: æ¢¯åº¦æ›´æ–°çš„å°æ‰¹é‡å¤§å°

### `--max_grad_norm`
- **ç±»å‹**: float
- **é»˜è®¤**: 0.5
- **è¯´æ˜**: æ¢¯åº¦è£å‰ªé˜ˆå€¼

---

## WandBå‚æ•°

### `--use_wandb`
- **ç±»å‹**: flag
- **é»˜è®¤**: False
- **è¯´æ˜**: å¯ç”¨WandBæ—¥å¿—è®°å½•

### `--wandb_project`
- **ç±»å‹**: string
- **é»˜è®¤**: `streamvln_hybrid`
- **è¯´æ˜**: WandBé¡¹ç›®åç§°

### `--wandb_run_name`
- **ç±»å‹**: string
- **é»˜è®¤**: è‡ªåŠ¨ç”Ÿæˆï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
- **è¯´æ˜**: WandBè¿è¡Œåç§°

---

## ğŸ¯ è®­ç»ƒç­–ç•¥å»ºè®®

### åœºæ™¯1: å¿«é€ŸéªŒè¯
```bash
--num_updates 100
--num_episodes_per_update 1
--group_size 1
```

### åœºæ™¯2: æ ‡å‡†è®­ç»ƒ
```bash
--num_updates 500
--num_episodes_per_update 1
--group_size 2
--use_hybrid_training
--sft_loss_start_weight 1.0
--sft_loss_end_weight 0.9
```

### åœºæ™¯3: å®Œæ•´è®­ç»ƒ
```bash
--num_updates 1000
--num_episodes_per_update 2
--group_size 2
--use_hybrid_training
--sft_loss_start_weight 1.5
--sft_loss_end_weight 0.8
```

### åœºæ™¯4: æ¶ˆèç ”ç©¶ï¼ˆæ— ä¸“å®¶å¹²é¢„ï¼‰
```bash
--disable_recovery
--use_hybrid_training
# å…¶ä»–å‚æ•°ä¿æŒé»˜è®¤
```

---

## âš™ï¸ é«˜çº§é…ç½®

### DeepSpeedé…ç½®

è®­ç»ƒè„šæœ¬æ”¯æŒDeepSpeedåŠ é€Ÿï¼š

```bash
# åœ¨train_hybrid.shä¸­æ·»åŠ 
--use_deepspeed \
--deepspeed_config scripts/zero2.json
```

### LoRAé…ç½®

LoRAå‚æ•°åœ¨è®­ç»ƒä»£ç ä¸­ç¡¬ç¼–ç ï¼š
- `r=32`: LoRAç§©
- `alpha=64`: LoRAç¼©æ”¾å› å­
- **å¯è®­ç»ƒå‚æ•°**: ~13.9M / 8B total (0.17%)

---

## ğŸ› è°ƒè¯•æŠ€å·§

### æ£€æŸ¥è®­ç»ƒæ˜¯å¦æ­£å¸¸

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -100 result/your_output_dir/training.log

# æ£€æŸ¥GPUä½¿ç”¨
nvidia-smi

# æŸ¥çœ‹WandBé“¾æ¥
grep "View run at" result/your_output_dir/training.log
```

### å¸¸è§é—®é¢˜

**Q: è®­ç»ƒé€Ÿåº¦å¤ªæ…¢ï¼Ÿ**
- å‡å°‘ `group_size`
- ä½¿ç”¨æ›´å¿«çš„æ•°æ®é›†é…ç½®ï¼ˆ`vln_merged_fast.yaml`ï¼‰
- å¯ç”¨DeepSpeed

**Q: æ˜¾å­˜ä¸è¶³ï¼Ÿ**
- å‡å°‘ `mini_batch_size`
- å‡å°‘ `group_size`
- å¯ç”¨gradient checkpointingï¼ˆé»˜è®¤å¼€å¯ï¼‰

**Q: æ€§èƒ½ä¸æ”¶æ•›ï¼Ÿ**
- å¢åŠ  `sft_loss_start_weight`
- å»¶é•¿ `sft_loss_decay_updates`
- æ£€æŸ¥ä¸“å®¶å¹²é¢„æ˜¯å¦æ­£å¸¸è§¦å‘

---

## ğŸ“Š å…³é”®æŒ‡æ ‡

è®­ç»ƒè¿‡ç¨‹ä¸­é‡ç‚¹å…³æ³¨ä»¥ä¸‹æŒ‡æ ‡ï¼š

1. **Success Rate (SR)**: æˆåŠŸåˆ°è¾¾ç›®æ ‡çš„æ¯”ä¾‹
2. **SPL**: Success weighted by Path Length
3. **Oracle Rate**: ä¸“å®¶å¹²é¢„è§¦å‘ç‡ï¼ˆå»ºè®®10-30%ï¼‰
4. **Avg Episode Length**: å¹³å‡episodeé•¿åº¦
5. **GRPO Loss**: å¼ºåŒ–å­¦ä¹ æŸå¤±
6. **SFT Loss**: ç›‘ç£å­¦ä¹ æŸå¤±
7. **SFT Weight**: å½“å‰SFTæƒé‡ï¼ˆåº”è¯¥é€æ¸è¡°å‡ï¼‰

---

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒä¸»READMEæˆ–æäº¤Issueå’¨è¯¢ã€‚
